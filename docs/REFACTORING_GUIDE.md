# é¡¹ç›®é‡æ„æŒ‡å—

## é‡æ„æ¦‚è¿°

æœ¬é¡¹ç›®ä»ç®€å•çš„æ‰å¹³åŒ–ç›®å½•ç»“æ„é‡æ„ä¸ºç¬¦åˆ NestJS æœ€ä½³å®è·µçš„æ¨¡å—åŒ–æ¶æ„ï¼Œä¸ºæœªæ¥æ‰©å±•ä¸ºå®Œæ•´çš„åç«¯ç®¡ç†ç³»ç»Ÿå¥ å®šåŸºç¡€ã€‚

## é‡æ„å‰åå¯¹æ¯”

### é‡æ„å‰ç»“æ„ï¼ˆæ‰å¹³åŒ–ï¼‰

```
src/
â”œâ”€â”€ auth/              # è®¤è¯ç›¸å…³
â”œâ”€â”€ config/            # é…ç½®æ–‡ä»¶
â”œâ”€â”€ controllers/       # æ§åˆ¶å™¨
â”œâ”€â”€ decorators/        # è£…é¥°å™¨
â”œâ”€â”€ entities/          # å®ä½“
â”œâ”€â”€ guards/            # å®ˆå«
â”œâ”€â”€ services/          # æœåŠ¡
â””â”€â”€ seed/             # ç§å­æ•°æ®
```

### é‡æ„åç»“æ„ï¼ˆæ¨¡å—åŒ–ï¼‰

```
src/
â”œâ”€â”€ modules/           # ä¸šåŠ¡æ¨¡å—
â”‚   â”œâ”€â”€ auth/         # è®¤è¯æ¨¡å—
â”‚   â””â”€â”€ users/        # ç”¨æˆ·ç®¡ç†æ¨¡å—
â”œâ”€â”€ shared/           # å…±äº«ç»„ä»¶
â”‚   â”œâ”€â”€ entities/     # æ•°æ®åº“å®ä½“
â”‚   â”œâ”€â”€ config/       # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ decorators/   # è£…é¥°å™¨
â”‚   â”œâ”€â”€ guards/       # å®ˆå«
â”‚   â””â”€â”€ services/     # å…±äº«æœåŠ¡
â”œâ”€â”€ common/           # é€šç”¨åŠŸèƒ½
â”‚   â””â”€â”€ logger/       # æ—¥å¿—æ¨¡å—
â””â”€â”€ database/         # æ•°æ®åº“ç›¸å…³
    â””â”€â”€ seeds/        # ç§å­æ•°æ®
```

## é‡æ„æ”¶ç›Š

### 1. æ¸…æ™°çš„æ¶æ„åˆ†å±‚

- **modules/**: ä¸šåŠ¡é€»è¾‘æ¨¡å—ï¼ŒèŒè´£æ˜ç¡®
- **shared/**: è·¨æ¨¡å—å…±äº«ç»„ä»¶ï¼Œé¿å…é‡å¤
- **common/**: é€šç”¨åŠŸèƒ½ï¼Œå¯å¤ç”¨åˆ°å…¶ä»–é¡¹ç›®
- **database/**: æ•°æ®åº“ç›¸å…³åŠŸèƒ½é›†ä¸­ç®¡ç†

### 2. æ›´å¥½çš„å¯ç»´æŠ¤æ€§

- æ¨¡å—é—´ä¾èµ–å…³ç³»æ¸…æ™°
- æ–‡ä»¶ä½ç½®ç¬¦åˆçº¦å®šï¼Œå®¹æ˜“æŸ¥æ‰¾
- ä¾¿äºå›¢é˜Ÿåä½œå¼€å‘

### 3. æ›´å¼ºçš„å¯æ‰©å±•æ€§

- æ–°å¢ä¸šåŠ¡æ¨¡å—åªéœ€åœ¨ `modules/` ä¸‹åˆ›å»º
- å…±äº«ç»„ä»¶å¯ä»¥è¢«ä»»ä½•æ¨¡å—ä½¿ç”¨
- æ”¯æŒå¾®æœåŠ¡æ¶æ„æ¼”è¿›

### 4. ç¬¦åˆ NestJS æœ€ä½³å®è·µ

- éµå¾ªå®˜æ–¹æ¨èçš„ç›®å½•ç»“æ„
- ä¾¿äºä½¿ç”¨ Nest CLI ç”Ÿæˆä»£ç 
- é€‚åˆå¤§å‹é¡¹ç›®å¼€å‘

## é‡æ„æ­¥éª¤è¯¦è§£

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæ–°çš„ç›®å½•ç»“æ„

```bash
mkdir -p src/modules/{auth,users}
mkdir -p src/shared/{entities,config,decorators,guards,services}
mkdir -p src/common/logger
mkdir -p src/database/seeds
```

### ç¬¬äºŒæ­¥ï¼šè¿ç§»è®¤è¯æ¨¡å—

```bash
# å°†æ•´ä¸ª auth/ ç›®å½•ç§»åŠ¨åˆ° modules/auth/
mv src/auth/* src/modules/auth/
```

### ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºç”¨æˆ·ç®¡ç†æ¨¡å—

- ä» `controllers/users.controller.ts` åˆ›å»ºå®Œæ•´çš„ç”¨æˆ·æ¨¡å—
- æ–°å¢ `UsersModule` å’Œ `UsersService`
- å»ºç«‹æ¨¡å—é—´ä¾èµ–å…³ç³»

### ç¬¬å››æ­¥ï¼šæ•´ç†å…±äº«ç»„ä»¶

```bash
# ç§»åŠ¨å®ä½“åˆ° shared/entities/
mv src/entities/* src/shared/entities/

# ç§»åŠ¨é…ç½®åˆ° shared/config/
mv src/config/* src/shared/config/

# ç§»åŠ¨è£…é¥°å™¨ã€å®ˆå«ã€æœåŠ¡ç­‰
mv src/decorators/* src/shared/decorators/
mv src/guards/* src/shared/guards/
mv src/services/* src/shared/services/
```

### ç¬¬äº”æ­¥ï¼šå»ºç«‹é€šç”¨æ¨¡å—

- å°†æ—¥å¿—åŠŸèƒ½ç§»åŠ¨åˆ° `common/logger/`
- åˆ›å»º `LoggerModule` ç”¨äº Winston é›†æˆ

### ç¬¬å…­æ­¥ï¼šè¿ç§»æ•°æ®åº“ç›¸å…³

```bash
mv src/seed/* src/database/seeds/
```

### ç¬¬ä¸ƒæ­¥ï¼šæ›´æ–°å¯¼å…¥è·¯å¾„

ä½¿ç”¨è„šæœ¬æ‰¹é‡æ›´æ–°æ‰€æœ‰æ–‡ä»¶ä¸­çš„ import è·¯å¾„ï¼š

```bash
#!/bin/bash
find src -name "*.ts" -type f -exec sed -i '' \
  's|from '\''\.\/entities\/|from '\''\.\/\.\.\/shared\/entities\/|g' {} \;
```

### ç¬¬å…«æ­¥ï¼šä¿®å¤ä¾èµ–æ³¨å…¥

- ç¡®ä¿æ‰€æœ‰æ¨¡å—æ­£ç¡®å¯¼å…¥æ‰€éœ€çš„ä¾èµ–
- ä¿®å¤ Repository æ³¨å…¥é—®é¢˜
- è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜

## é‡æ„ä¸­çš„å…³é”®é—®é¢˜è§£å†³

### 1. Repository ä¾èµ–æ³¨å…¥

**é—®é¢˜**: SeedService æ— æ³•æ‰¾åˆ° UserRepository
**è§£å†³**: åœ¨ AppModule ä¸­æ·»åŠ  `TypeOrmModule.forFeature([User, Role, Permission])`

### 2. æ¨¡å—é—´ä¾èµ–

**é—®é¢˜**: UsersController éœ€è¦ AuthService
**è§£å†³**: åœ¨ UsersModule ä¸­å¯¼å…¥ AuthModule

### 3. å¯¼å…¥è·¯å¾„æ›´æ–°

**é—®é¢˜**: å¤§é‡æ–‡ä»¶çš„å¯¼å…¥è·¯å¾„éœ€è¦æ›´æ–°
**è§£å†³**: ä½¿ç”¨æ‰¹é‡æ›¿æ¢è„šæœ¬è‡ªåŠ¨æ›´æ–°

## åç»­æ‰©å±•å»ºè®®

### 1. æ–°å¢ä¸šåŠ¡æ¨¡å—ç¤ºä¾‹

```
src/modules/
â”œâ”€â”€ auth/          # âœ… å·²å®Œæˆ
â”œâ”€â”€ users/         # âœ… å·²å®Œæˆ
â”œâ”€â”€ roles/         # ğŸ”„ å»ºè®®æ–°å¢
â”œâ”€â”€ permissions/   # ğŸ”„ å»ºè®®æ–°å¢
â”œâ”€â”€ logs/          # ğŸ”„ å»ºè®®æ–°å¢
â””â”€â”€ system/        # ğŸ”„ å»ºè®®æ–°å¢
```

### 2. æ•°æ®ä¼ è¾“å¯¹è±¡ (DTOs)

åœ¨æ¯ä¸ªæ¨¡å—ä¸‹åˆ›å»º `dto/` ç›®å½•ï¼š

```
src/modules/users/
â”œâ”€â”€ dto/
â”‚   â”œâ”€â”€ create-user.dto.ts
â”‚   â”œâ”€â”€ update-user.dto.ts
â”‚   â””â”€â”€ user-response.dto.ts
â”œâ”€â”€ users.controller.ts
â”œâ”€â”€ users.service.ts
â””â”€â”€ users.module.ts
```

### 3. å¼‚å¸¸è¿‡æ»¤å™¨

åœ¨ `common/` ä¸‹æ·»åŠ ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†ï¼š

```
src/common/
â”œâ”€â”€ filters/
â”‚   â”œâ”€â”€ http-exception.filter.ts
â”‚   â””â”€â”€ validation.filter.ts
â””â”€â”€ logger/
```

### 4. é…ç½®ç®¡ç†ä¼˜åŒ–

ä½¿ç”¨ `@nestjs/config` æ›¿æ¢ç¯å¢ƒå˜é‡ç›´æ¥è¯»å–ï¼š

```typescript
// shared/config/database.config.ts
export const databaseConfig = {
  type: "mysql",
  host: process.env.DATABASE_HOST || "localhost",
  // ...
};
```

## æ€»ç»“

é€šè¿‡è¿™æ¬¡é‡æ„ï¼Œé¡¹ç›®ä»ç®€å•çš„ Demo è½¬å˜ä¸ºå…·å¤‡ç”Ÿäº§çº§æ¶æ„çš„ NestJS åº”ç”¨ã€‚æ–°çš„ç›®å½•ç»“æ„ä¸ä»…æé«˜äº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œä¹Ÿä¸ºåç»­åŠŸèƒ½æ‰©å±•æä¾›äº†è‰¯å¥½çš„åŸºç¡€ã€‚

è¿™ç§æ¨¡å—åŒ–æ¶æ„ç‰¹åˆ«é€‚åˆï¼š

- å¤§å‹å›¢é˜Ÿåä½œå¼€å‘
- åŠŸèƒ½æ¨¡å—ç‹¬ç«‹éƒ¨ç½²
- ä»£ç å¤ç”¨å’Œå…±äº«
- é¡¹ç›®é•¿æœŸç»´æŠ¤

é‡æ„å®Œæˆåï¼Œé¡¹ç›®å·²ç»å…·å¤‡äº†å‘å®Œæ•´åç«¯ç®¡ç†ç³»ç»Ÿæ¼”è¿›çš„åŸºç¡€æ¶æ„ã€‚
