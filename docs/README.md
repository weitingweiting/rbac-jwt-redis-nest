# 📚 项目文档目录

欢迎查看 RBAC + JWT + Redis Demo 项目文档！

## 📖 文档列表

### 🚀 [快速开始](./快速开始.md)

5 分钟快速上手项目，包括：

- 环境准备和安装步骤
- Docker 容器启动
- **数据库初始化（重要说明）**
- 默认账户信息
- 常见问题解决

**适合：** 第一次使用项目的开发者

---

### 🏗️ [项目结构](./项目结构.md)

详细的项目架构说明，包括：

- 完整的目录结构
- 分层架构设计
- 模块依赖关系
- 核心模块职责
- RBAC 权限系统设计
- 数据库 ERD 图

**适合：** 需要深入了解项目架构的开发者

---

### 🛠️ [开发指南](./开发指南.md)

核心功能实现详解，包括：

- JWT 认证流程
- RBAC 权限系统实现
- 数据验证（class-validator）
- 数据库操作（TypeORM）
- 软删除机制
- 异常处理
- 日志记录
- 队列任务（BullMQ）

**适合：** 正在开发新功能的开发者

---

### 📖 [API 接口](./API接口.md)

完整的 REST API 文档，包括：

- 认证接口（注册、登录、刷新 Token）
- 用户管理接口
- 角色管理接口
- 权限管理接口
- 项目空间管理接口
- 项目管理接口
- 项目资源管理接口
- 错误响应格式

**适合：** 前端开发者、接口测试人员

---

### 🚀 [部署指南](./部署指南.md)

生产环境部署完整方案，包括：

- 部署架构图
- 服务器环境准备
- Docker 生产配置
- **数据库初始化选择（重要）**
- Nginx 反向代理配置
- SSL 证书配置
- 安全加固措施
- 监控和日志管理
- 备份策略
- 故障排查

**适合：** 运维人员、部署负责人

---

## 🔑 关键概念

### 数据库初始化说明

项目提供 **两种方式** 初始化数据库，**选择其一即可**：

#### 方式一：使用 Seed 脚本（⭐ 推荐）

```bash
npm run seed
```

**特点：**

- ✅ TypeORM 自动创建表结构（synchronize: true）
- ✅ 自动插入初始数据（权限、角色、用户、示例项目）
- ✅ 支持增量更新
- ✅ **开发和生产环境推荐**

**何时使用：**

- 首次部署项目
- 开发环境快速初始化
- 需要重置数据库到初始状态

#### 方式二：执行 SQL 脚本

```bash
# 通过 docker
docker exec -i rbac-demo-mysql mysql -uroot -ppassword rbac_demo < init.sql

# 或通过 Adminer 手动导入
```

**特点：**

- ✅ 手动执行 SQL，完全可控
- ✅ 适合理解数据库结构
- ⚠️ 需要手动管理表结构变更

**何时使用：**

- 学习数据库结构
- 需要完全控制初始化过程
- 不信任 TypeORM 自动建表

### 默认账户

所有环境初始化后都会创建以下账户：

| 用户名 | 密码      | 角色   | 权限数量                       |
| ------ | --------- | ------ | ------------------------------ |
| admin  | Admin123  | 管理员 | 27个（全部）                   |
| editor | Editor123 | 编辑者 | 19个（查看、创建、更新、发布） |
| viewer | Viewer123 | 查看者 | 7个（仅查看）                  |

## 🛠️ 技术栈

- **框架**: NestJS 10.x
- **语言**: TypeScript 5.x
- **数据库**: MySQL 8.0
- **缓存**: Redis 7.x
- **ORM**: TypeORM
- **认证**: JWT + Passport
- **队列**: BullMQ
- **日志**: Winston
- **验证**: class-validator
- **测试**: Bruno (API测试)

## 📦 核心功能

- ✅ JWT 认证和 Token 刷新
- ✅ Token 黑名单（登出功能）
- ✅ RBAC 权限系统（基于 permission code）
- ✅ 用户、角色、权限管理
- ✅ 项目空间和项目管理
- ✅ 软删除机制
- ✅ Redis 权限缓存
- ✅ 全局异常处理
- ✅ 统一响应格式
- ✅ 日志系统（按级别和日期分割）
- ✅ 数据验证
- ✅ BullMQ 队列系统

## 📂 文档更新记录

- **2025-11-30**: 重新整理文档结构，合并相关内容，统一为中文文档
- 删除临时修复文档（CIRCULAR_DEPENDENCY_FIX.md 等）
- 明确数据库初始化的两种方式及其选择
- 更新部署指南，增加生产环境配置
- 添加完整的 API 接口文档

## 🆘 需要帮助？

### 常见问题

1. **数据库连接失败**
   - 检查 Docker 容器是否启动：`docker ps`
   - 查看 MySQL 日志：`docker logs rbac-demo-mysql`
   - 验证环境变量配置

2. **权限验证失败**
   - 确认 Token 有效性
   - 检查用户权限缓存：Redis 中 `user:*:permissions` 键
   - 验证角色权限配置

3. **TypeORM synchronize 问题**
   - 开发环境：`synchronize: true`（自动同步表结构）
   - 生产环境：`synchronize: false`（使用 migrations 管理）

### 获取支持

- 查看文档：优先阅读相关文档章节
- 查看日志：检查 `logs/` 目录下的日志文件
- API 测试：使用 Bruno 测试集合验证接口
- 代码调试：使用 VSCode 断点调试

## 🗺️ 学习路径

### 新手入门（第 1 天）

1. [快速开始](./快速开始.md) - 安装和启动项目
2. [API 接口](./API接口.md) - 测试基础接口
3. 使用 Bruno 执行测试用例

### 深入理解（第 2-3 天）

1. [项目结构](./项目结构.md) - 了解架构
2. [开发指南](./开发指南.md) - 学习核心功能
3. 阅读源代码，理解实现细节

### 生产部署（第 4-5 天）

1. [部署指南](./部署指南.md) - 部署到服务器
2. 配置 Nginx、SSL
3. 设置监控和备份

---

**祝你使用愉快！如有问题，请先查阅相关文档。** 🎉
